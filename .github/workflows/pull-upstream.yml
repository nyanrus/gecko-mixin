# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

# ¬© 2023 Floorp Projects & Contributors

name: "(U) üß∞ Pull upstream"

on:
  workflow_dispatch:


jobs:
  pull-upstream:
    name: Pull upstream
    runs-on: ubuntu-latest

    steps:
    - name: Setup ü™õ
      run: |
        export DATE_STR=`date +"%Y%m%d%I%M%S"`
        echo "DATE_STR=$DATE_STR" >> $GITHUB_ENV

    - name: Setup git ü™õ
      run: |
        git config --global user.name github-actions
        git config --global user.email github-actions@github.com

    - name: Clone mozilla/gecko-dev üß¨
      run: |
        git clone https://github.com/mozilla/gecko-dev
        cd gecko-dev
        git checkout -b upstream-release-${DATE_STR} origin/master

    - name: Fetch nyanrus/gecko-dev
      run: |
        cd gecko-dev
        git remote add lfozta https://${GITHUB_ACTOR}:${{ github.token }}@github.com/nyanrus/gecko-dev.git
        git fetch lfozta

    - name: Push üéÅ
      run: |
        cd gecko-dev
        # https://stackoverflow.com/questions/64374179/how-to-push-to-another-repository-in-github-actions
        git config --unset-all http.https://github.com/.extraheader
        git push lfozta upstream-release-${DATE_STR}

    - name: Create Pull Request
      run: |
        cd gecko-dev
        gh pr create --repo ${{ github.repository_owner }}/gecko-dev --base master --head upstream-release-${DATE_STR} --title "Pull upstream" --body "Warning: Be sure to create a merge commit and merge it in."
      env:
        GH_TOKEN: ${{ github.token }}
